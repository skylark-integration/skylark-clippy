{"version":3,"sources":["Balloon.js"],"names":["define","$","[object Object]","targetEl","this","_targetEl","_hidden","_setup","WORD_SPEAK_TIME","CLOSE_BALLOON_DELAY","_BALLOON_MARGIN","_balloon","hide","_content","find","document","body","append","sides","i","length","s","_position","_isOut","side","o","offset","h","height","w","width","top","window","scrollTop","left","scrollLeft","bH","outerHeight","bW","outerWidth","removeClass","css","addClass","wW","wH","sT","sL","complete","text","hold","show","c","reposition","_complete","_sayWords","fast","_hiding","setTimeout","proxy","_finishHideBalloon","_active","_hold","words","split","time","el","idx","_addWord","slice","join","_loop","clearTimeout"],"mappings":"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","file":"../Balloon.js","sourcesContent":["define(['skylark-jquery'], function ($) {\n    'use strict';\n    class Balloon {\n        constructor(targetEl) {\n            this._targetEl = targetEl;\n            this._hidden = true;\n            this._setup();\n            this.WORD_SPEAK_TIME = 200;\n            this.CLOSE_BALLOON_DELAY = 2000;\n            this._BALLOON_MARGIN = 15;\n        }\n        _setup() {\n            this._balloon = $('<div class=\"clippy-balloon\"><div class=\"clippy-tip\"></div><div class=\"clippy-content\"></div></div> ').hide();\n            this._content = this._balloon.find('.clippy-content');\n            $(document.body).append(this._balloon);\n        }\n        reposition() {\n            let sides = [\n                'top-left',\n                'top-right',\n                'bottom-left',\n                'bottom-right'\n            ];\n            for (let i = 0; i < sides.length; i++) {\n                let s = sides[i];\n                this._position(s);\n                if (!this._isOut())\n                    break;\n            }\n        }\n        _position(side) {\n            let o = this._targetEl.offset();\n            let h = this._targetEl.height();\n            let w = this._targetEl.width();\n            o.top -= $(window).scrollTop();\n            o.left -= $(window).scrollLeft();\n            let bH = this._balloon.outerHeight();\n            let bW = this._balloon.outerWidth();\n            this._balloon.removeClass('clippy-top-left');\n            this._balloon.removeClass('clippy-top-right');\n            this._balloon.removeClass('clippy-bottom-right');\n            this._balloon.removeClass('clippy-bottom-left');\n            let left, top;\n            switch (side) {\n            case 'top-left':\n                left = o.left + w - bW;\n                top = o.top - bH - this._BALLOON_MARGIN;\n                break;\n            case 'top-right':\n                left = o.left;\n                top = o.top - bH - this._BALLOON_MARGIN;\n                break;\n            case 'bottom-right':\n                left = o.left;\n                top = o.top + h + this._BALLOON_MARGIN;\n                break;\n            case 'bottom-left':\n                left = o.left + w - bW;\n                top = o.top + h + this._BALLOON_MARGIN;\n                break;\n            }\n            this._balloon.css({\n                top: top,\n                left: left\n            });\n            this._balloon.addClass('clippy-' + side);\n        }\n        _isOut() {\n            let o = this._balloon.offset();\n            let bH = this._balloon.outerHeight();\n            let bW = this._balloon.outerWidth();\n            let wW = $(window).width();\n            let wH = $(window).height();\n            let sT = $(document).scrollTop();\n            let sL = $(document).scrollLeft();\n            let top = o.top - sT;\n            let left = o.left - sL;\n            let m = 5;\n            if (top - m < 0 || left - m < 0)\n                return true;\n            return top + bH + m > wH || left + bW + m > wW;\n        }\n        speak(complete, text, hold) {\n            this._hidden = false;\n            this.show();\n            let c = this._content;\n            c.height('auto');\n            c.width('auto');\n            c.text(text);\n            c.height(c.height());\n            c.width(c.width());\n            c.text('');\n            this.reposition();\n            this._complete = complete;\n            this._sayWords(text, hold, complete);\n        }\n        show() {\n            if (this._hidden)\n                return;\n            this._balloon.show();\n        }\n        hide(fast) {\n            if (fast) {\n                this._balloon.hide();\n                return;\n            }\n            this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\n        }\n        _finishHideBalloon() {\n            if (this._active)\n                return;\n            this._balloon.hide();\n            this._hidden = true;\n            this._hiding = null;\n        }\n        _sayWords(text, hold, complete) {\n            this._active = true;\n            this._hold = hold;\n            let words = text.split(/[^\\S-]/);\n            let time = this.WORD_SPEAK_TIME;\n            let el = this._content;\n            let idx = 1;\n            this._addWord = $.proxy(function () {\n                if (!this._active)\n                    return;\n                if (idx > words.length) {\n                    delete this._addWord;\n                    this._active = false;\n                    if (!this._hold) {\n                        complete();\n                        this.hide();\n                    }\n                } else {\n                    el.text(words.slice(0, idx).join(' '));\n                    idx++;\n                    this._loop = window.setTimeout($.proxy(this._addWord, this), time);\n                }\n            }, this);\n            this._addWord();\n        }\n        close() {\n            if (this._active) {\n                this._hold = false;\n            } else if (this._hold) {\n                this._complete();\n            }\n        }\n        pause() {\n            window.clearTimeout(this._loop);\n            if (this._hiding) {\n                window.clearTimeout(this._hiding);\n                this._hiding = null;\n            }\n        }\n        resume() {\n            if (this._addWord) {\n                this._addWord();\n            } else if (!this._hold && !this._hidden) {\n                this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\n            }\n        }\n    }\n\n    return Balloon;\n});"]}